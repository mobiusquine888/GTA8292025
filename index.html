<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VibeViz - Audio Visualizer</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            font-family: 'Arial', sans-serif;
            color: white;
            overflow: hidden;
        }
        
        #canvas {
            display: block;
            width: 100vw;
            height: 100vh;
        }
        
        /* Navigation Bar */
        .navbar {
            position: fixed;
            top: 0;
            width: 100%;
            background: rgba(0, 0, 0, 0.9);
            padding: 15px 20px;
            z-index: 1000;
            display: flex;
            justify-content: space-between;
            align-items: center;
            backdrop-filter: blur(10px);
        }
        
        .logo {
            font-size: 24px;
            font-weight: bold;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        /* Control Panel */
        .controls {
            position: fixed;
            left: 20px;
            top: 80px;
            background: rgba(0, 0, 0, 0.9);
            padding: 20px;
            border-radius: 15px;
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            width: 280px;
            max-height: calc(100vh - 120px);
            overflow-y: auto;
            z-index: 900;
        }
        
        .control-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-size: 12px;
            color: #ccc;
        }
        
        input[type="range"] {
            width: 100%;
            margin-bottom: 5px;
        }
        
        select, button, input {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 10px;
            border-radius: 8px;
            width: 100%;
            font-size: 12px;
            margin-bottom: 5px;
        }
        
        button {
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        button:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }
        
        .record-btn {
            background: linear-gradient(45deg, #ef4444, #f97316);
            font-size: 16px;
            padding: 15px;
        }
        
        .social-btn {
            background: linear-gradient(45deg, #8b5cf6, #06b6d4);
            margin: 5px 0;
        }
        
        .hidden { display: none; }
        
        .value-display {
            color: #4ecdc4;
            font-weight: bold;
            float: right;
        }
        
        .stats {
            background: rgba(255, 255, 255, 0.1);
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
        }
        
        .stat-item {
            display: flex;
            justify-content: space-between;
            margin: 5px 0;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>
    
    <!-- Navigation -->
    <div class="navbar">
        <div class="logo">üéµ VibeViz</div>
    </div>
    
    <!-- Main Controls -->
    <div class="controls">
        <h3>üéõÔ∏è Audio Visualizer</h3>
        
        <div class="control-group">
            <button id="startBtn" class="record-btn">üéµ Start Visualizer</button>
            <button id="demoBtn" class="hidden">üéµ Demo Mode</button>
        </div>
        
        <div id="mainControls" class="hidden">
            <div class="control-group">
                <label>Visual Style:</label>
                <select id="visualStyle">
                    <option value="particles">Particle Storm</option>
                    <option value="waves">Wave Ripples</option>
                    <option value="bars">3D Frequency Bars</option>
                    <option value="tunnel">Tunnel Vision</option>
                    <option value="galaxy">Galaxy Effect</option>
                </select>
            </div>
            
            <div class="control-group">
                <label>Sensitivity: <span class="value-display" id="sensitivityValue">50</span></label>
                <input type="range" id="sensitivity" min="1" max="100" value="50">
            </div>
            
            <div class="control-group">
                <label>Color Theme:</label>
                <select id="colorMode">
                    <option value="rainbow">Rainbow Spectrum</option>
                    <option value="fire">Fire & Ice</option>
                    <option value="ocean">Ocean Waves</option>
                    <option value="neon">Neon Nights</option>
                    <option value="galaxy">Space Galaxy</option>
                </select>
            </div>
            
            <div class="control-group">
                <label>Particle Count: <span class="value-display" id="particleCountValue">300</span></label>
                <input type="range" id="particleCount" min="50" max="1000" value="300">
            </div>
            
            <div class="control-group">
                <label>Speed: <span class="value-display" id="speedValue">50</span></label>
                <input type="range" id="speed" min="10" max="100" value="50">
            </div>
        </div>
        
        <div class="control-group">
            <h4>üìπ Capture</h4>
            <button id="screenshotBtn" class="social-btn">üì∏ Take Screenshot</button>
        </div>
        
        <div class="stats">
            <h4>üìä Session Stats</h4>
            <div class="stat-item">
                <span>Runtime:</span>
                <span id="runtime">0:00</span>
            </div>
            <div class="stat-item">
                <span>Screenshots:</span>
                <span id="screenshotCount">0</span>
            </div>
        </div>
    </div>

    <script>
        class AudioVisualizer {
            constructor() {
                this.canvas = document.getElementById('canvas');
                this.ctx = this.canvas.getContext('2d');
                this.audioContext = null;
                this.analyser = null;
                this.dataArray = null;
                this.particles = [];
                this.isRunning = false;
                this.startTime = null;
                this.screenshotCount = 0;
                
                this.settings = {
                    sensitivity: 50,
                    visualStyle: 'particles',
                    colorMode: 'rainbow',
                    particleCount: 300,
                    speed: 50
                };
                
                this.setupCanvas();
                this.setupControls();
                this.initParticles();
                this.startStats();
            }
            
            setupCanvas() {
                this.resizeCanvas();
                window.addEventListener('resize', () => this.resizeCanvas());
            }
            
            resizeCanvas() {
                this.canvas.width = window.innerWidth;
                this.canvas.height = window.innerHeight;
            }
            
            setupControls() {
                document.getElementById('startBtn').addEventListener('click', () => this.start());
                document.getElementById('demoBtn').addEventListener('click', () => this.playDemo());
                document.getElementById('screenshotBtn').addEventListener('click', () => this.takeScreenshot());
                
                document.getElementById('visualStyle').addEventListener('change', (e) => {
                    this.settings.visualStyle = e.target.value;
                });
                
                document.getElementById('colorMode').addEventListener('change', (e) => {
                    this.settings.colorMode = e.target.value;
                });
                
                document.getElementById('sensitivity').addEventListener('input', (e) => {
                    this.settings.sensitivity = e.target.value;
                    document.getElementById('sensitivityValue').textContent = e.target.value;
                });
                
                document.getElementById('particleCount').addEventListener('input', (e) => {
                    this.settings.particleCount = parseInt(e.target.value);
                    document.getElementById('particleCountValue').textContent = e.target.value;
                    this.initParticles();
                });
                
                document.getElementById('speed').addEventListener('input', (e) => {
                    this.settings.speed = e.target.value;
                    document.getElementById('speedValue').textContent = e.target.value;
                });
            }
            
            async start() {
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                    this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    const source = this.audioContext.createMediaStreamSource(stream);
                    
                    this.analyser = this.audioContext.createAnalyser();
                    this.analyser.fftSize = 256;
                    source.connect(this.analyser);
                    
                    this.dataArray = new Uint8Array(this.analyser.frequencyBinCount);
                    
                    document.getElementById('startBtn').classList.add('hidden');
                    document.getElementById('demoBtn').classList.remove('hidden');
                    document.getElementById('mainControls').classList.remove('hidden');
                    
                    this.isRunning = true;
                    this.startTime = Date.now();
                    this.animate();
                } catch (err) {
                    alert('Microphone access required. Try demo mode instead.');
                    document.getElementById('demoBtn').classList.remove('hidden');
                    document.getElementById('mainControls').classList.remove('hidden');
                }
            }
            
            playDemo() {
                this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                this.analyser = this.audioContext.createAnalyser();
                this.analyser.fftSize = 256;
                this.dataArray = new Uint8Array(this.analyser.frequencyBinCount);
                
                // Create rich demo audio
                const oscillators = [];
                const frequencies = [220, 330, 440, 550, 660, 880];
                
                frequencies.forEach((freq, i) => {
                    const osc = this.audioContext.createOscillator();
                    const gain = this.audioContext.createGain();
                    
                    osc.frequency.setValueAtTime(freq, this.audioContext.currentTime);
                    osc.type = ['sine', 'triangle', 'sawtooth', 'square'][i % 4];
                    gain.gain.setValueAtTime(0.06, this.audioContext.currentTime);
                    
                    osc.connect(gain);
                    gain.connect(this.analyser);
                    this.analyser.connect(this.audioContext.destination);
                    
                    osc.start();
                    oscillators.push({ osc, gain, baseFreq: freq });
                });
                
                // Dynamic demo animation
                let time = 0;
                const updateDemo = () => {
                    time += 0.03;
                    oscillators.forEach((item, i) => {
                        const modulation = Math.sin(time * 2 + i * 0.8) * 0.4 + 0.6;
                        const freqMod = 1 + Math.sin(time * 1.5 + i * 0.5) * 0.4;
                        item.gain.gain.setValueAtTime(modulation * 0.06, this.audioContext.currentTime);
                        item.osc.frequency.setValueAtTime(item.baseFreq * freqMod, this.audioContext.currentTime);
                    });
                };
                
                const demoInterval = setInterval(updateDemo, 50);
                
                setTimeout(() => {
                    oscillators.forEach(item => item.osc.stop());
                    clearInterval(demoInterval);
                    alert('Demo ended - click "Start Visualizer" for live microphone input!');
                }, 45000);
                
                this.isRunning = true;
                this.startTime = Date.now();
                this.animate();
            }
            
            takeScreenshot() {
                // Convert canvas to image
                const link = document.createElement('a');
                link.download = `vibeViz-${Date.now()}.png`;
                link.href = this.canvas.toDataURL();
                link.click();
                
                this.screenshotCount++;
                document.getElementById('screenshotCount').textContent = this.screenshotCount;
                
                // Visual feedback
                this.ctx.fillStyle = 'rgba(255, 255, 255, 0.3)';
                this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);
            }
            
            startStats() {
                setInterval(() => {
                    if (this.startTime) {
                        const elapsed = Date.now() - this.startTime;
                        const minutes = Math.floor(elapsed / 60000);
                        const seconds = Math.floor((elapsed % 60000) / 1000);
                        document.getElementById('runtime').textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
                    }
                }, 1000);
            }
            
            initParticles() {
                this.particles = [];
                for (let i = 0; i < this.settings.particleCount; i++) {
                    this.particles.push({
                        x: Math.random() * this.canvas.width,
                        y: Math.random() * this.canvas.height,
                        vx: (Math.random() - 0.5) * 2,
                        vy: (Math.random() - 0.5) * 2,
                        size: Math.random() * 3 + 1,
                        hue: Math.random() * 360,
                        life: 1,
                        originalX: 0,
                        originalY: 0,
                        angle: Math.random() * Math.PI * 2
                    });
                    this.particles[i].originalX = this.particles[i].x;
                    this.particles[i].originalY = this.particles[i].y;
                }
            }
            
            getColor(intensity, index) {
                const hue = (index * 3) % 360;
                const saturation = 70 + intensity * 30;
                const lightness = 30 + intensity * 40;
                
                switch (this.settings.colorMode) {
                    case 'fire':
                        return `hsl(${intensity * 60}, 100%, ${lightness}%)`;
                    case 'ocean':
                        return `hsl(${180 + intensity * 60}, 80%, ${lightness}%)`;
                    case 'neon':
                        return `hsl(${(hue + intensity * 180) % 360}, 100%, ${50 + intensity * 25}%)`;
                    case 'galaxy':
                        return `hsl(${260 + intensity * 80}, 90%, ${40 + intensity * 30}%)`;
                    default: // rainbow
                        return `hsl(${hue + intensity * 60}, ${saturation}%, ${lightness}%)`;
                }
            }
            
            drawParticles(audioData) {
                const speedMultiplier = this.settings.speed / 50;
                
                this.particles.forEach((particle, i) => {
                    const audioIndex = Math.floor((i / this.particles.length) * audioData.length);
                    const intensity = (audioData[audioIndex] / 255) * (this.settings.sensitivity / 50);
                    
                    particle.vx += (Math.random() - 0.5) * intensity * 0.5 * speedMultiplier;
                    particle.vy += (Math.random() - 0.5) * intensity * 0.5 * speedMultiplier;
                    particle.x += particle.vx;
                    particle.y += particle.vy;
                    particle.size = 1 + intensity * 6;
                    
                    if (particle.x < 0 || particle.x > this.canvas.width) particle.vx *= -0.8;
                    if (particle.y < 0 || particle.y > this.canvas.height) particle.vy *= -0.8;
                    
                    particle.x = Math.max(0, Math.min(this.canvas.width, particle.x));
                    particle.y = Math.max(0, Math.min(this.canvas.height, particle.y));
                    
                    this.ctx.beginPath();
                    this.ctx.arc(particle.x, particle.y, particle.size, 0, Math.PI * 2);
                    this.ctx.fillStyle = this.getColor(intensity, i);
                    this.ctx.shadowBlur = 10 + intensity * 20;
                    this.ctx.shadowColor = this.getColor(intensity, i);
                    this.ctx.fill();
                });
            }
            
            drawWaves(audioData) {
                const centerX = this.canvas.width / 2;
                const centerY = this.canvas.height / 2;
                const maxRadius = Math.min(centerX, centerY) * 0.8;
                
                for (let i = 0; i < audioData.length; i++) {
                    const intensity = (audioData[i] / 255) * (this.settings.sensitivity / 50);
                    const angle = (i / audioData.length) * Math.PI * 2;
                    const radius = intensity * maxRadius;
                    
                    const x = centerX + Math.cos(angle) * radius;
                    const y = centerY + Math.sin(angle) * radius;
                    
                    this.ctx.beginPath();
                    this.ctx.arc(x, y, 2 + intensity * 8, 0, Math.PI * 2);
                    this.ctx.fillStyle = this.getColor(intensity, i);
                    this.ctx.shadowBlur = 15;
                    this.ctx.shadowColor = this.getColor(intensity, i);
                    this.ctx.fill();
                }
            }
            
            drawBars(audioData) {
                const barWidth = this.canvas.width / audioData.length;
                
                for (let i = 0; i < audioData.length; i++) {
                    const intensity = (audioData[i] / 255) * (this.settings.sensitivity / 50);
                    const barHeight = intensity * this.canvas.height * 0.8;
                    
                    const x = i * barWidth;
                    const y = this.canvas.height - barHeight;
                    
                    const gradient = this.ctx.createLinearGradient(x, y, x, this.canvas.height);
                    gradient.addColorStop(0, this.getColor(intensity, i));
                    gradient.addColorStop(1, 'rgba(0,0,0,0.2)');
                    
                    this.ctx.fillStyle = gradient;
                    this.ctx.fillRect(x, y, barWidth - 1, barHeight);
                    this.ctx.shadowBlur = 10;
                    this.ctx.shadowColor = this.getColor(intensity, i);
                    this.ctx.fillRect(x, y, barWidth - 1, Math.min(30, barHeight));
                }
            }
            
            drawTunnel(audioData) {
                const centerX = this.canvas.width / 2;
                const centerY = this.canvas.height / 2;
                const avgIntensity = audioData.reduce((a, b) => a + b, 0) / audioData.length / 255;
                
                for (let ring = 0; ring < 15; ring++) {
                    const radius = ring * 40 + avgIntensity * 150;
                    const segments = 24;
                    
                    for (let i = 0; i < segments; i++) {
                        const angle = (i / segments) * Math.PI * 2;
                        const audioIndex = Math.floor((i / segments) * audioData.length);
                        const intensity = (audioData[audioIndex] / 255) * (this.settings.sensitivity / 50);
                        
                        const innerRadius = radius - intensity * 25;
                        const outerRadius = radius + intensity * 25;
                        
                        this.ctx.beginPath();
                        this.ctx.arc(centerX, centerY, outerRadius, angle, angle + (Math.PI * 2) / segments);
                        this.ctx.arc(centerX, centerY, innerRadius, angle + (Math.PI * 2) / segments, angle, true);
                        this.ctx.closePath();
                        
                        this.ctx.fillStyle = this.getColor(intensity, ring * segments + i);
                        this.ctx.shadowBlur = 5;
                        this.ctx.shadowColor = this.getColor(intensity, ring * segments + i);
                        this.ctx.fill();
                    }
                }
            }
            
            drawGalaxy(audioData) {
                const centerX = this.canvas.width / 2;
                const centerY = this.canvas.height / 2;
                const time = Date.now() * 0.001;
                
                for (let i = 0; i < audioData.length; i++) {
                    const intensity = (audioData[i] / 255) * (this.settings.sensitivity / 50);
                    const angle = (i / audioData.length) * Math.PI * 4 + time;
                    const radius = (i / audioData.length) * Math.min(centerX, centerY) * 0.8;
                    
                    const spiralX = centerX + Math.cos(angle) * radius;
                    const spiralY = centerY + Math.sin(angle) * radius;
                    
                    const size = 2 + intensity * 8;
                    
                    this.ctx.beginPath();
                    this.ctx.arc(spiralX, spiralY, size, 0, Math.PI * 2);
                    this.ctx.fillStyle = this.getColor(intensity, i);
                    this.ctx.shadowBlur = 15 + intensity * 10;
                    this.ctx.shadowColor = this.getColor(intensity, i);
                    this.ctx.fill();
                    
                    // Add sparkle effect
                    if (intensity > 0.5) {
                        for (let j = 0; j < 3; j++) {
                            const sparkleX = spiralX + (Math.random() - 0.5) * 20;
                            const sparkleY = spiralY + (Math.random() - 0.5) * 20;
                            this.ctx.beginPath();
                            this.ctx.arc(sparkleX, sparkleY, 1, 0, Math.PI * 2);
                            this.ctx.fillStyle = `rgba(255, 255, 255, ${intensity})`;
                            this.ctx.fill();
                        }
                    }
                }
            }
            
            animate() {
                if (!this.isRunning) return;
                
                if (this.analyser) {
                    this.analyser.getByteFrequencyData(this.dataArray);
                }
                
                this.ctx.fillStyle = 'rgba(0, 0, 0, 0.1)';
                this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);
                
                if (this.dataArray) {
                    switch (this.settings.visualStyle) {
                        case 'particles':
                            this.drawParticles(this.dataArray);
                            break;
                        case 'waves':
                            this.drawWaves(this.dataArray);
                            break;
                        case 'bars':
                            this.drawBars(this.dataArray);
                            break;
                        case 'tunnel':
                            this.drawTunnel(this.dataArray);
                            break;
                        case 'galaxy':
                            this.drawGalaxy(this.dataArray);
                            break;
                    }
                }
                
                requestAnimationFrame(() => this.animate());
            }
        }
        
        // Initialize the app
        window.addEventListener('load', () => {
            new AudioVisualizer();
        });
    </script>
</body>
</html>
