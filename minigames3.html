<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GTAFastLane Mini-Games - Ultimate Gaming Hub</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #00ffa2;
            --secondary-color: #ff007c;
            --accent-color: #8a2be2;
            --text-color: #000000;
            --bg-color: #ffffff;
            --card-bg: #f8f9fa;
            --border-color: #dee2e6;
            --shadow: 0 4px 25px rgba(0,0,0,0.1);
            --gradient-primary: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            --success-color: #28a745;
            --warning-color: #ffc107;
            --danger-color: #dc3545;
            --gold-color: #ffd700;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Montserrat', sans-serif;
            background: var(--bg-color);
            color: var(--text-color);
            transition: all 0.3s ease;
            min-height: 100vh;
        }

        .header {
            background: var(--gradient-primary);
            color: white;
            padding: 2rem 1rem;
            text-align: center;
            position: relative;
            box-shadow: var(--shadow);
        }

        .header h1 {
            font-size: clamp(2rem, 6vw, 3rem);
            margin-bottom: 0.5rem;
            font-weight: 900;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .stat-number { 
            font-size: 1.8rem; font-weight: 900; color: white; 
            display: block; margin-bottom: 0.25rem; text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        }
        .stat-label { font-size: 0.9rem; opacity: 0.9; font-weight: 600; }

        .container { max-width: 1400px; margin: 0 auto; padding: 2rem 1rem; }

        .games-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1.5rem;
            margin-top: 2rem;
        }

        @media (max-width: 1024px) {
            .games-grid { grid-template-columns: repeat(2, 1fr); }
        }

        @media (max-width: 640px) {
            .games-grid { grid-template-columns: 1fr; }
        }

        .game-card {
            background: var(--card-bg); border-radius: 15px; padding: 1.2rem;
            box-shadow: var(--shadow); border: 1px solid var(--border-color);
            transition: all 0.3s ease; overflow: hidden;
            position: relative;
        }

        .game-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 25px rgba(0,0,0,0.15);
        }

        .game-title {
            font-size: 1.2rem; font-weight: 700; margin-bottom: 0.5rem;
            background: var(--gradient-primary); -webkit-background-clip: text;
            -webkit-text-fill-color: transparent; background-clip: text;
        }

        .game-stats {
            display: flex; justify-content: space-between; font-size: 0.8rem;
            margin-bottom: 0.5rem; color: #555;
        }

        .game-arena {
            width: 100%; height: 180px; background: #87CEEB; border-radius: 10px;
            margin-bottom: 0.5rem; position: relative; overflow: hidden;
            cursor: crosshair;
        }

        .game-controls {
            display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem;
            margin-bottom: 0.5rem;
        }

        .control-btn {
            padding: 0.4rem; font-size: 0.75rem; border: none;
            border-radius: 8px; cursor: pointer; font-weight: 600;
            transition: all 0.2s;
        }

        .control-btn.gas { background: var(--success-color); color: white; }
        .control-btn.special { background: var(--accent-color); color: white; }

        .floating-btn {
            width: 100%; padding: 0.6rem; background: var(--gradient-primary);
            color: white; border: none; border-radius: 10px; font-weight: 700;
            cursor: pointer; font-size: 0.9rem; transition: all 0.2s;
        }

        .floating-btn:hover { transform: scale(1.02); }

        .game-status {
            text-align: center; margin-top: 0.5rem; font-size: 0.8rem;
            display: none;
        }

        /* Target Practice Specific */
        #targetRange {
            background: linear-gradient(180deg, #87CEEB 0%, #DAA520 70%, #8B4513 100%);
            cursor: crosshair;
        }

        #scopeOverlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; background: radial-gradient(circle at center, transparent 40%, rgba(0,0,0,0.8) 50%);
            opacity: 0; transition: opacity 0.3s;
        }

        #crosshair {
            position: absolute; top: 50%; left: 50%; width: 30px; height: 30px;
            margin: -15px 0 0 -15px; border: 3px solid rgba(255,0,0,0.8);
            border-radius: 50%; pointer-events: none; transition: all 0.1s;
            box-shadow: 0 0 10px red; z-index: 10;
        }

        .target-dish, .target-tire, .target-coyote {
            position: absolute; font-size: 1.5rem; user-select: none;
            transition: transform 0.1s;
        }

        .target-tire { font-size: 0.6rem !important; }

        .particle {
            position: absolute; width: 6px; height: 6px; background: #ff4500;
            border-radius: 50%; pointer-events: none; opacity: 0;
            animation: explode 0.6s ease-out forwards;
        }

        @keyframes explode {
            0% { transform: scale(0); opacity: 1; }
            100% { transform: scale(3); opacity: 0; }
        }

        .gold-star { color: var(--gold-color); font-size: 1.2rem; }
    </style>
</head>
<body>
    <div class="header">
        <h1>GTAFastLane Mini-Games</h1>
        <div style="display: flex; justify-content: center; gap: 2rem; margin-top: 1rem; flex-wrap: wrap;">
            <div><span class="stat-number" id="totalGames">43</span><span class="stat-label">Games</span></div>
            <div><span class="stat-number" id="totalPlayers">1,247</span><span class="stat-label">Active</span></div>
            <div><span class="stat-number" id="totalScore">89.2K</span><span class="stat-label">High Score</span></div>
        </div>
    </div>

    <div class="container">
        <div class="games-grid">

            <!-- === GAME 1: TARGET PRACTICE (CLETUS EWING) - FULLY FIXED & INTERACTIVE === -->
            <div class="game-card">
                <div class="game-title">Target Practice (Cletus Ewing)</div>
                <div class="game-stats">
                    <span>Stage: <strong id="targetStage">1/3</strong></span>
                    <span>Accuracy: <strong id="targetAccuracy">100</strong>%</span>
                    <span>Time: <strong id="targetTimer">90</strong>s</span>
                    <span>Gold: <strong id="targetGold">0/3</strong></span>
                </div>
                <div id="targetRange" class="game-arena">
                    <div id="scopeOverlay"></div>
                    <div id="crosshair"></div>
                </div>
                <div id="targetInstructions" style="text-align: center; font-size: 0.8rem; color: var(--primary-color); margin: 0.5rem 0; font-weight: bold;">
                    Select mode to begin
                </div>
                <div class="game-controls" style="grid-template-columns: repeat(3, 1fr);">
                    <button class="control-btn" id="modeEasy">Easy</button>
                    <button class="control-btn gas" id="modeMedium">Medium</button>
                    <button class="control-btn special" id="modeHard">Hard</button>
                </div>
                <button class="floating-btn" id="targetStartBtn">Join Cletus (Nervous Ron Req.)</button>
                <div id="targetGameOver" class="game-status">
                    <strong id="targetResult"></strong>
                    <p id="targetFinalScore"></p>
                    <div id="goldMedals" style="margin-top: 0.5rem; font-size: 0.7rem;"></div>
                </div>
            </div>

            <!-- Placeholder for Games 2-43 -->
            <!-- Add more game-cards here -->

        </div>
    </div>

    <script>
        // ==================== TARGET PRACTICE: FULL GTA 5 MISSION RECREATION - FIXED STAGE 3 ====================
        let targetState = {
            stage: 1,
            mode: 'easy',
            timeLeft: 90,
            score: 0,
            shots: 0, hits: 0, accuracy: 100,
            dishes: 0, tires: 0, coyotes: 0,
            doubleKills: 0,
            goldReq: { dishes: true, tires: false, coyotes: false },
            isPlaying: false, timer: null, audioCtx: null,
            targets: [], vehicles: [], coyotes: [], particles: [],
            coyoteCount: 0, requiredCoyotes: 0
        };

        const modeConfig = {
            easy: { time: 90, dishReq: 3, tireReq: 3, coyoteReq: 3, accReq: 60, doubleReq: 0, speed: 1.0 },
            medium: { time: 60, dishReq: 3, tireReq: 4, coyoteReq: 4, accReq: 75, doubleReq: 1, speed: 1.5 },
            hard: { time: 45, dishReq: 4, tireReq: 5, coyoteReq: 5, accReq: 85, doubleReq: 2, speed: 2.2 }
        };

        // Audio Setup
        function initAudio() {
            targetState.audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        }

        function playSound(type, freq = 800, duration = 0.1) {
            if (!targetState.audioCtx) return;
            const osc = targetState.audioCtx.createOscillator();
            const gain = targetState.audioCtx.createGain();
            osc.connect(gain); gain.connect(targetState.audioCtx.destination);
            osc.type = type === 'hit' ? 'sine' : type === 'miss' ? 'square' : 'sawtooth';
            osc.frequency.setValueAtTime(freq, targetState.audioCtx.currentTime);
            if (type === 'gunshot') osc.frequency.exponentialRampToValueAtTime(200, targetState.audioCtx.currentTime + 0.1);
            gain.gain.setValueAtTime(0.3, targetState.audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, targetState.audioCtx.currentTime + duration);
            osc.start(); osc.stop(targetState.audioCtx.currentTime + duration);
        }

        function playCletus(text) {
            const msg = new SpeechSynthesisUtterance(text);
            msg.rate = 0.9; msg.pitch = 0.8;
            const voices = speechSynthesis.getVoices();
            const gravelly = voices.find(v => v.name.includes('Daniel') || v.name.includes('Fred') || v.name.includes('Google'));
            if (gravelly) msg.voice = gravelly;
            speechSynthesis.speak(msg);
        }

        // Mode Selection
        ['Easy', 'Medium', 'Hard'].forEach(m => {
            const btn = document.getElementById(`mode${m}`);
            if (btn) {
                btn.onclick = () => {
                    targetState.mode = m.toLowerCase();
                    document.querySelectorAll('[id^="mode"]').forEach(b => b.style.opacity = '0.6');
                    btn.style.opacity = '1';
                    document.getElementById('targetInstructions').textContent = `Mode: ${m} | Click Start to join Cletus!`;
                };
            }
        });

        // Start Game
        const startBtn = document.getElementById('targetStartBtn');
        if (startBtn) startBtn.onclick = startTargetPractice;

        function startTargetPractice() {
            initAudio();
            const cfg = modeConfig[targetState.mode];
            targetState = {
                ...targetState,
                stage: 1, timeLeft: cfg.time, score: 0, shots: 0, hits: 0, accuracy: 100,
                dishes: 0, tires: 0, coyotes: 0, doubleKills: 0, coyoteCount: 0, requiredCoyotes: cfg.coyoteReq,
                goldReq: { dishes: true, tires: false, coyotes: false },
                isPlaying: true, targets: [], vehicles: [], coyotes: [], particles: []
            };

            document.getElementById('targetGameOver').style.display = 'none';
            startBtn.disabled = true;
            document.getElementById('scopeOverlay').style.opacity = 1;

            updateTargetDisplay();
            nextStage();
            targetState.timer = setInterval(tickTimer, 1000);

            const range = document.getElementById('targetRange');
            range.addEventListener('click', shoot);
            range.addEventListener('mousemove', moveCrosshair);
            range.addEventListener('touchstart', e => { e.preventDefault(); moveCrosshair(e.touches[0]); shoot(e.touches[0]); }, { passive: false });
        }

        function moveCrosshair(e) {
            const cross = document.getElementById('crosshair');
            const rect = document.getElementById('targetRange').getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            cross.style.left = x + 'px';
            cross.style.top = y + 'px';
        }

        function tickTimer() {
            targetState.timeLeft--;
            document.getElementById('targetTimer').textContent = targetState.timeLeft;
            if (targetState.timeLeft <= 0) endGame();
        }

        function updateTargetDisplay() {
            document.getElementById('targetStage').textContent = `${targetState.stage}/3`;
            document.getElementById('targetAccuracy').textContent = targetState.accuracy;
            document.getElementById('targetTimer').textContent = targetState.timeLeft;
            document.getElementById('targetGold').textContent = `${Object.values(targetState.goldReq).filter(v => v).length}/3`;
        }

        function nextStage() {
            clearTargets();
            const cfg = modeConfig[targetState.mode];
            const stages = {
                1: { text: 'Cletus: "Shoot them satellite dishes! No misses, boy!"', spawn: () => spawnDishes(cfg.dishReq) },
                2: { text: 'Driving to motel... Pop them tires!', spawn: () => spawnVehicles(cfg.tireReq) },
                3: { text: 'On the roof! Kill them coyotes â€” line up fer 2-fer-1!', spawn: () => spawnCoyotes(cfg.coyoteReq) }
            };
            const s = stages[targetState.stage];
            document.getElementById('targetInstructions').textContent = s.text;
            playCletus(s.text.split(':')[1]?.trim() || s.text);
            setTimeout(s.spawn, 1500);
        }

        function clearTargets() {
            [...targetState.targets, ...targetState.vehicles, ...targetState.coyotes].forEach(t => {
                if (t.el && t.el.parentElement) t.el.remove();
            });
            targetState.targets = []; targetState.vehicles = []; targetState.coyotes = [];
        }

        function spawnDishes(count) {
            const range = document.getElementById('targetRange');
            for (let i = 0; i < count; i++) {
                const dish = document.createElement('div');
                dish.className = 'target-dish';
                dish.textContent = 'Satellite';
                dish.style.left = `${15 + i * 18}%`;
                dish.style.top = `${25 + (i % 2) * 25}%`;
                dish.dataset.type = 'dish';
                range.appendChild(dish);
                targetState.targets.push({ el: dish, hit: false });
            }
        }

        function spawnVehicles(count) {
            const range = document.getElementById('targetRange');
            for (let i = 0; i < count; i++) {
                setTimeout(() => {
                    const car = document.createElement('div');
                    car.textContent = 'Car';
                    car.style.fontSize = '2rem';
                    car.style.position = 'absolute';
                    car.style.left = '-10%';
                    car.style.top = `${35 + (i % 3) * 18}%`;
                    car.dataset.type = 'vehicle';
                    range.appendChild(car);

                    const speed = 3000 / modeConfig[targetState.mode].speed;
                    const anim = car.animate([{ left: '-10%' }, { left: '110%' }], { duration: speed, easing: 'linear' });
                    anim.onfinish = () => { if (car.parentElement) car.remove(); };

                    const tire1 = createTire(car, '15%', '70%');
                    const tire2 = createTire(car, '75%', '70%');
                    targetState.vehicles.push({ el: car, tires: [tire1, tire2], popped: 0 });
                }, i * 1800);
            }
        }

        function createTire(parent, left, top) {
            const tire = document.createElement('div');
            tire.className = 'target-tire';
            tire.textContent = 'Tire';
            tire.style.position = 'absolute';
            tire.style.left = left; tire.style.top = top;
            tire.dataset.type = 'tire';
            parent.appendChild(tire);
            return tire;
        }

        function spawnCoyotes(count) {
            const range = document.getElementById('targetRange');
            targetState.coyoteCount = 0;
            for (let i = 0; i < count; i++) {
                const coy = createCoyote(range);
                targetState.coyotes.push({ el: coy, hit: false });
                targetState.coyoteCount++;
            }
        }

        function createCoyote(range) {
            const coy = document.createElement('div');
            coy.className = 'target-coyote';
            coy.textContent = 'Coyote';
            coy.style.left = `${Math.random() * 60 + 20}%`;
            coy.style.top = `${Math.random() * 40 + 40}%`;
            coy.dataset.type = 'coyote';
            range.appendChild(coy);

            // Continuous movement
            const move = () => {
                if (!coy.parentElement || targetState.coyotes.find(c => c.el === coy)?.hit) return;
                coy.style.transition = 'all 1.2s ease-in-out';
                coy.style.left = `${Math.random() * 60 + 20}%`;
                coy.style.top = `${Math.random() * 40 + 40}%`;
                setTimeout(move, 1200 + Math.random() * 800);
            };
            setTimeout(move, Math.random() * 1000);
            return coy;
        }

        function shoot(e) {
            if (!targetState.isPlaying) return;
            playSound('gunshot');
            targetState.shots++;
            const rect = document.getElementById('targetRange').getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;

            let hit = false;
            let multi = 0;
            const hitCoyotes = [];

            // Check dishes
            targetState.targets.forEach(t => {
                if (t.hit || !t.el.parentElement) return;
                const r = t.el.getBoundingClientRect();
                if (x > r.left - rect.left && x < r.right - rect.left && y > r.top - rect.top && y < r.bottom - rect.top) {
                    t.hit = true; t.el.textContent = 'Hit'; t.el.style.transform = 'scale(1.5)'; hit = true;
                    targetState.dishes++;
                    setTimeout(() => { if (t.el.parentElement) t.el.remove(); }, 500);
                    createParticles(x, y, 'Explosion');
                    playSound('hit', 600);
                }
            });

            // Check tires
            targetState.vehicles.forEach(v => {
                if (!v.el.parentElement) return;
                v.tires.forEach(tire => {
                    if (!tire || !tire.parentElement) return;
                    const r = tire.getBoundingClientRect();
                    if (x > r.left - rect.left && x < r.right - rect.left && y > r.top - rect.top && y < r.bottom - rect.top) {
                        tire.textContent = 'Pop'; tire.style.transform = 'scale(1.8)'; hit = true;
                        v.popped = (v.popped || 0) + 1;
                        targetState.tires++;
                        playSound('hit', 400, 0.2);
                        if (v.popped >= 2) v.el.style.transform = 'rotate(20deg)';
                        setTimeout(() => { if (tire.parentElement) tire.remove(); }, 300);
                    }
                });
            });

            // Check coyotes
            targetState.coyotes.forEach(c => {
                if (c.hit || !c.el.parentElement) return;
                const r = c.el.getBoundingClientRect();
                if (x > r.left - rect.left && x < r.right - rect.left && y > r.top - rect.top && y < r.bottom - rect.top) {
                    c.hit = true; hitCoyotes.push(c);
                }
            });

            if (hitCoyotes.length > 0) {
                hit = true; multi = hitCoyotes.length;
                targetState.coyotes = targetState.coyotes.filter(c => !c.hit);
                targetState.coyoteCount -= multi;
                if (multi > 1) targetState.doubleKills++;
                hitCoyotes.forEach(c => {
                    c.el.textContent = 'Dead';
                    c.el.style.transform = 'scale(1.5)';
                    setTimeout(() => { if (c.el.parentElement) c.el.remove(); }, 600);
                });
                createParticles(x, y, multi > 1 ? '2 FOR 1!' : 'Blood');
                playSound('hit', 900);
            }

            if (hit) {
                targetState.hits++;
                targetState.score += 100 * (multi || 1);
            } else {
                playSound('miss', 300, 0.05);
            }

            targetState.accuracy = targetState.shots > 0 ? Math.round((targetState.hits / targetState.shots) * 100) : 100;
            updateTargetDisplay();
            checkStageComplete();
        }

        function createParticles(x, y, emoji = 'Sparkle') {
            for (let i = 0; i < 8; i++) {
                const p = document.createElement('div');
                p.className = 'particle';
                p.textContent = emoji;
                p.style.left = (x + (Math.random() - 0.5) * 20) + 'px';
                p.style.top = (y + (Math.random() - 0.5) * 20) + 'px';
                document.getElementById('targetRange').appendChild(p);
                setTimeout(() => { if (p.parentElement) p.remove(); }, 600);
            }
        }

        function checkStageComplete() {
            const cfg = modeConfig[targetState.mode];
            let complete = false;

            if (targetState.stage === 1 && targetState.dishes >= cfg.dishReq) complete = true;
            else if (targetState.stage === 2 && targetState.tires >= cfg.tireReq) complete = true;
            else if (targetState.stage === 3 && targetState.coyoteCount <= 0) complete = true;

            if (complete && targetState.stage < 3) {
                targetState.stage++;
                setTimeout(nextStage, 1500);
            } else if (complete && targetState.stage === 3) {
                endGame(true);
            }
        }

        function endGame(auto = false) {
            if (!targetState.isPlaying) return;
            targetState.isPlaying = false;
            clearInterval(targetState.timer);
            document.getElementById('targetStartBtn').disabled = false;
            document.getElementById('scopeOverlay').style.opacity = 0;

            const cfg = modeConfig[targetState.mode];
            const gold = {
                dishes: targetState.dishes >= cfg.dishReq && (targetState.shots - targetState.hits) <= 0,
                tires: targetState.tires >= cfg.tireReq && targetState.accuracy >= cfg.accReq,
                coyotes: targetState.coyoteCount <= 0 && targetState.doubleKills >= cfg.doubleReq
            };
            const goldCount = Object.values(gold).filter(v => v).length;
            targetState.goldReq = gold;

            const result = goldCount === 3 ? 'GOLD MEDAL!' : goldCount > 0 ? 'Mission Complete' : 'Mission Failed';
            document.getElementById('targetResult').textContent = result;
            document.getElementById('targetFinalScore').textContent = `Score: ${targetState.score} | Accuracy: ${targetState.accuracy}% | Double Kills: ${targetState.doubleKills}`;
            document.getElementById('goldMedals').innerHTML = `
                Bad Signal: ${gold.dishes ? '<span class="gold-star">Gold</span>' : 'Failed'}<br>
                Pop! Pop!: ${gold.tires ? '<span class="gold-star">Gold</span>' : 'Failed'}<br>
                2 for 1: ${gold.coyotes ? '<span class="gold-star">Gold</span>' : 'Failed'}
            `;
            document.getElementById('targetGameOver').style.display = 'block';

            if (goldCount === 3) {
                playCletus("Yee-haw! You got all gold, partner!");
            }
        }

        // Load speech voices
        if ('speechSynthesis' in window) {
            speechSynthesis.onvoiceschanged = () => {};
        }
    </script>
</body>
</html>
